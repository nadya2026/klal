<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCC 26 - نظام إدارة جداول المباريات EA FC 26</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI','Noto Sans Arabic',Tahoma,sans-serif; }
        body { background:#0f172a; color:#e2e8f0; line-height:1.6; min-height:100vh; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        .header { background:linear-gradient(135deg,rgba(10,25,50,.9),rgba(0,0,0,.95)); color:white; padding:25px 40px; border-radius:15px; margin-bottom:30px; box-shadow:0 4px 20px rgba(0,0,0,.6); border:1px solid rgba(59,130,246,.3); }
        .header-content { display:flex; justify-content:space-between; align-items:center; }
        .logo-section { display:flex; align-items:center; gap:20px; }
        .logo { width:70px; height:70px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); border-radius:12px; display:flex; align-items:center; justify-content:center; color:white; font-size:28px; font-weight:bold; box-shadow:0 4px 15px rgba(59,130,246,.4); }
        .title-section h1 { font-size:28px; font-weight:700; margin-bottom:5px; }
        .title-section p { color:#94a3b8; font-size:16px; }
        .badge { background:rgba(59,130,246,.2); padding:8px 20px; border-radius:20px; font-size:14px; font-weight:600; border:1px solid rgba(59,130,246,.4); }
        .main-grid { display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:40px; }
        @media (max-width:1024px) { .main-grid { grid-template-columns:1fr; } }
        .card { background:rgba(15,23,42,.7); border-radius:15px; padding:30px; box-shadow:0 4px 20px rgba(0,0,0,.5); border:1px solid rgba(59,130,246,.2); backdrop-filter:blur(8px); }
        .card-title { font-size:20px; color:#e2e8f0; margin-bottom:25px; padding-bottom:15px; border-bottom:2px solid rgba(59,130,246,.3); font-weight:600; }
        .card-title i { color:#3b82f6; margin-left:10px; }
        .form-group { margin-bottom:25px; }
        .form-label { display:block; margin-bottom:8px; color:#cbd5e1; font-weight:600; font-size:15px; }
        .form-control { width:100%; padding:14px 18px; border:2px solid rgba(59,130,246,.3); border-radius:10px; font-size:15px; background:rgba(30,41,59,.6); color:white; transition:all .3s; }
        .form-control:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.3); }
        .match-row { background:rgba(30,41,59,.5); border-radius:12px; padding:25px; margin-bottom:15px; border:1px solid rgba(59,130,246,.2); position:relative; }
        .match-number { position:absolute; top:20px; right:20px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:bold; box-shadow:0 4px 15px rgba(59,130,246,.4); }
        .player-input { text-align:center; padding:15px; background:rgba(15,23,42,.8); border:2px solid rgba(59,130,246,.3); border-radius:8px; color:white; font-size:16px; font-weight:500; width:100%; }
        .vs-circle { width:60px; height:60px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px; box-shadow:0 4px 15px rgba(59,130,246,.5); }
        .time-input-container { display:flex; align-items:center; justify-content:center; gap:10px; margin-top:15px; }
        .time-input { padding:10px 20px; border:2px solid rgba(59,130,246,.3); border-radius:8px; background:rgba(15,23,42,.8); color:white; font-size:15px; width:120px; text-align:center; }
        .am-pm-btn { padding:10px 15px; border:2px solid rgba(59,130,246,.3); border-radius:8px; background:rgba(15,23,42,.8); color:white; cursor:pointer; min-width:60px; }
        .am-pm-btn.active { background:#3b82f6; border-color:#3b82f6; }
        .remove-match { position:absolute; top:15px; left:15px; width:36px; height:36px; border-radius:8px; background:rgba(239,68,68,.2); border:none; color:#ef4444; cursor:pointer; }
        .add-match-btn { width:100%; padding:16px; background:#3b82f6; color:white; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; }
        .add-match-btn:hover { background:#2563eb; }
        .control-buttons { display:flex; gap:15px; margin-top:30px; }
        .btn { flex:1; padding:16px; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; }
        .btn-preview { background:#10b981; color:white; }
        .btn-download { background:#f59e0b; color:white; }
        .font-size-controls { background:rgba(15,23,42,.5); border-radius:10px; padding:20px; margin-top:20px; border:1px solid rgba(59,130,246,.2); }
        .font-size-options { display:flex; gap:15px; margin-top:10px; flex-wrap:wrap; }
        .font-size-option { flex:1; min-width:100px; padding:12px; text-align:center; background:rgba(30,41,59,.6); border:2px solid rgba(59,130,246,.3); border-radius:8px; cursor:pointer; color:#e2e8f0; }
        .font-size-option.selected { background:#3b82f6; border-color:#3b82f6; }
        .preview-section { background:rgba(15,23,42,.7); border-radius:15px; padding:30px; box-shadow:0 4px 20px rgba(0,0,0,.5); border:1px solid rgba(59,130,246,.2); min-height:700px; }
        .preview-table { width:100%; border-collapse:collapse; margin-top:30px; color:white; }
        .preview-table th { background:rgba(30,58,138,.6); padding:18px; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); }
        .preview-table td { padding:20px; text-align:center; border-bottom:1px solid rgba(59,130,246,.2); }
        .match-number-cell { background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; font-weight:bold; font-size:20px; border-radius:50%; width:50px; height:50px; display:flex; align-items:center; justify-content:center; margin:0 auto; }
        .vs-cell { background:rgba(59,130,246,.3); padding:8px 24px; border-radius:999px; font-weight:bold; }
        .time-cell { background:rgba(255,255,255,.08); padding:10px 20px; border-radius:8px; }
        .empty-message { text-align:center; padding:100px 20px; color:#94a3b8; }
        .empty-message i { font-size:5rem; opacity:.4; }
        .footer { text-align:center; margin-top:50px; padding-top:30px; border-top:1px solid rgba(59,130,246,.2); color:#94a3b8; font-size:14px; }
        .two-columns-container { display:flex; gap:30px; width:100%; margin-top:20px; }
        .column { flex:1; }
        .column-title { text-align:center; font-size:1.4rem; margin-bottom:20px; color:#e2e8f0; padding-bottom:10px; border-bottom:2px solid rgba(59,130,246,.3); }
        .attendance-checkbox { display:inline-block; margin-right:10px; }
        .checkbox-container { position:relative; display:inline-block; }
        .attendance-label { display:flex; align-items:center; gap:8px; cursor:pointer; }
        .attendance-checkbox-input { display:none; }
        .custom-checkbox { width:22px; height:22px; border:2px solid rgba(59,130,246,.5); border-radius:5px; display:flex; align-items:center; justify-content:center; transition:all 0.3s; }
        .attendance-checkbox-input:checked + .custom-checkbox { background:#10b981; border-color:#10b981; }
        .attendance-checkbox-input:checked + .custom-checkbox::after { content:'✓'; color:white; font-weight:bold; }
        .player-with-checkbox { display:flex; align-items:center; justify-content:center; gap:10px; }
        .attendance-controls { background:rgba(15,23,42,.5); border-radius:10px; padding:15px; margin-top:20px; border:1px solid rgba(59,130,246,.2); }
        .attendance-buttons { display:flex; gap:10px; margin-top:10px; }
        .attendance-btn { flex:1; padding:10px; border:none; border-radius:8px; background:#3b82f6; color:white; cursor:pointer; font-size:14px; }
        .attendance-btn.clear { background:#ef4444; }
        .attendance-btn.check-all { background:#10b981; }
        .white-checkbox { background:white !important; border:1px solid #94a3b8 !important; }
        .table-controls { background:rgba(15,23,42,.7); border-radius:15px; padding:20px; margin-top:30px; border:1px solid rgba(59,130,246,.3); }
        .table-controls-title { font-size:18px; color:#e2e8f0; margin-bottom:15px; text-align:center; }
        .table-control-buttons { display:flex; gap:15px; justify-content:center; flex-wrap:wrap; }
        .table-control-btn { padding:12px 20px; border:none; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:8px; min-width:140px; justify-content:center; }
        .table-control-btn.table1 { background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; }
        .table-control-btn.table2 { background:linear-gradient(135deg,#10b981,#059669); color:white; }
        .table-control-btn.reset { background:linear-gradient(135deg,#f59e0b,#d97706); color:white; }
        .table-control-btn:hover { opacity:0.9; transform:translateY(-2px); transition:all 0.3s; }
        .scale-info { text-align:center; color:#94a3b8; margin-top:15px; font-size:14px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">FC</div>
                    <div class="title-section">
                        <h1>بطولة FCC 26 - EA FC 26</h1>
                        <p>جدول المباريات - النسخة الاحترافية</p>
                    </div>
                </div>
                <div class="badge">EA SPORTS FC™ 26</div>
            </div>
        </header>

        <div class="main-grid">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-cog"></i> إعدادات البطولة</h2>
                <div class="form-group">
                    <label class="form-label">اسم البطولة</label>
                    <input type="text" id="tournament-title" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ ووقت البطولة</label>
                    <input type="datetime-local" id="tournament-date" class="form-control">
                </div>

                <h2 class="card-title" style="margin-top:40px;"><i class="fas fa-futbol"></i> إدارة المباريات</h2>
                <div id="matches-container"></div>
                <button id="add-match-btn" class="add-match-btn">
                    <i class="fas fa-plus"></i> إضافة مباراة جديدة
                </button>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-eye"></i> معاينة وتحميل</h2>
                <p style="color:#94a3b8; margin-bottom:20px;">خلفية محلية (fc26.png)</p>
                
                <div class="font-size-controls">
                    <label class="form-label">اختيار حجم الخط في المعاينة و PDF:</label>
                    <div class="font-size-options">
                        <div class="font-size-option selected" data-size="normal">عادي</div>
                        <div class="font-size-option" data-size="medium">متوسط</div>
                        <div class="font-size-option" data-size="large">كبير</div>
                        <div class="font-size-option" data-size="xlarge">كبير جداً</div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button id="preview-btn" class="btn btn-preview">
                        <i class="fas fa-eye"></i> معاينة الجدول
                    </button>
                    <button id="download-btn" class="btn btn-download">
                        <i class="fas fa-download"></i> تحميل PDF
                    </button>
                </div>
            </div>
        </div>

        <div class="preview-section">
            <div id="preview-container">
                <div class="empty-message">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>اضغط "معاينة الجدول" بعد إضافة المباريات</h3>
                </div>
            </div>
        </div>

        <!-- أزرار التحكم في تقليص الجداول -->
        <div class="table-controls">
            <h3 class="table-controls-title"><i class="fas fa-compress-alt"></i> التحكم في حجم الجداول للترتيب في الصورة</h3>
            <div class="table-control-buttons">
                <button id="shrink-table1-btn" class="table-control-btn table1">
                    <i class="fas fa-minus-circle"></i> تقليص الجدول 1
                </button>
                <button id="expand-table1-btn" class="table-control-btn table1">
                    <i class="fas fa-plus-circle"></i> تكبير الجدول 1
                </button>
                <button id="shrink-table2-btn" class="table-control-btn table2">
                    <i class="fas fa-minus-circle"></i> تقليص الجدول 2
                </button>
                <button id="expand-table2-btn" class="table-control-btn table2">
                    <i class="fas fa-plus-circle"></i> تكبير الجدول 2
                </button>
                <button id="reset-tables-btn" class="table-control-btn reset">
                    <i class="fas fa-sync-alt"></i> إعادة الضبط
                </button>
            </div>
            <div class="scale-info">
                <p>الاستخدام: تقليص الجداول لتوزيعها بشكل أفضل في الصورة</p>
                <p id="current-scales">مستويات التقليص الحالية: الجدول 1: 100% | الجدول 2: 100%</p>
            </div>
        </div>

        <footer class="footer">
            <p>© 2026 نظام جداول FCC 26 - مستوحى من EA SPORTS FC™ 26</p>
        </footer>
    </div>

    <script>
        let matches = [];
        const matchesContainer = document.getElementById('matches-container');
        const addMatchBtn = document.getElementById('add-match-btn');
        const previewBtn = document.getElementById('preview-btn');
        const downloadBtn = document.getElementById('download-btn');
        const previewContainer = document.getElementById('preview-container');
        let selectedFontSize = 'normal';
        
        // متغيرات التحكم في تقليص الجداول
        let table1Scale = 1.0;
        let table2Scale = 1.0;
        const table1ScaleStep = 0.1; // خطوة تقليص/تكبير الجدول 1
        const table2ScaleStep = 0.1; // خطوة تقليص/تكبير الجدول 2
        const minScale = 0.6; // الحد الأدنى للتقليص
        const maxScale = 1.2; // الحد الأقصى للتكبير

        // دالة لتحديث عرض مستويات التقليص
        function updateScaleDisplay() {
            const scalesInfo = document.getElementById('current-scales');
            scalesInfo.textContent = `مستويات التقليص الحالية: الجدول 1: ${Math.round(table1Scale * 100)}% | الجدول 2: ${Math.round(table2Scale * 100)}%`;
        }

        // دالة لتحويل الوقت من 12 ساعة إلى 24 ساعة
        function convertTo24Hour(time12h, period) {
            if (!time12h) return '';
            
            const [hours, minutes] = time12h.split(':').map(Number);
            let hours24 = hours;
            
            if (period === 'PM' && hours < 12) {
                hours24 = hours + 12;
            } else if (period === 'AM' && hours === 12) {
                hours24 = 0;
            }
            
            return `${hours24.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // دالة لتحويل الوقت من 24 ساعة إلى 12 ساعة
        function convertTo12Hour(time24h) {
            if (!time24h) return { time: '19:00', period: 'PM' };
            
            const [hours, minutes] = time24h.split(':').map(Number);
            let period = 'AM';
            let hours12 = hours;
            
            if (hours >= 12) {
                period = 'PM';
                if (hours > 12) {
                    hours12 = hours - 12;
                }
            } else if (hours === 0) {
                hours12 = 12;
            }
            
            return {
                time: `${hours12.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`,
                period: period
            };
        }

        // دالة لإنشاء صف مباراة جديد
        function createMatchRow(matchData = { player1: "", player2: "", time: "", player1Present: false, player2Present: false }, matchNumber) {
            const row = document.createElement('div');
            row.className = 'match-row';
            
            // تحويل الوقت إلى تنسيق 12 ساعة للعرض
            const time12h = convertTo12Hour(matchData.time || '19:00');
            
            row.innerHTML = `
                <div class="match-number">${matchNumber}</div>
                <button class="remove-match"><i class="fas fa-trash"></i></button>
                <div style="display:flex; align-items:center; justify-content:center; gap:20px; margin:20px 0;">
                    <div style="flex:1;">
                        <div class="player-with-checkbox">
                            <label class="attendance-label">
                                <input type="checkbox" class="attendance-checkbox-input player1-present" ${matchData.player1Present ? 'checked' : ''}>
                                <span class="custom-checkbox"></span>
                            </label>
                            <input type="text" class="player-input player1" placeholder="اسم اللاعب الأول" value="${matchData.player1 || ''}">
                        </div>
                    </div>
                    <div class="vs-circle">VS</div>
                    <div style="flex:1;">
                        <div class="player-with-checkbox">
                            <input type="text" class="player-input player2" placeholder="اسم اللاعب الثاني" value="${matchData.player2 || ''}">
                            <label class="attendance-label">
                                <input type="checkbox" class="attendance-checkbox-input player2-present" ${matchData.player2Present ? 'checked' : ''}>
                                <span class="custom-checkbox"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="time-input-container">
                    <span style="color:#94a3b8;">الوقت:</span>
                    <input type="time" class="time-input" value="${time12h.time}" step="300">
                    <button type="button" class="am-pm-btn ${time12h.period === 'PM' ? 'active' : ''}" data-period="PM">م</button>
                    <button type="button" class="am-pm-btn ${time12h.period === 'AM' ? 'active' : ''}" data-period="AM">ص</button>
                </div>
            `;
            
            // إضافة أحداث لأزرار AM/PM
            const amBtn = row.querySelector('[data-period="AM"]');
            const pmBtn = row.querySelector('[data-period="PM"]');
            
            function updatePeriodButtons(activePeriod) {
                amBtn.classList.toggle('active', activePeriod === 'AM');
                pmBtn.classList.toggle('active', activePeriod === 'PM');
            }
            
            amBtn.addEventListener('click', () => {
                updatePeriodButtons('AM');
            });
            
            pmBtn.addEventListener('click', () => {
                updatePeriodButtons('PM');
            });
            
            // إضافة حدث لحذف المباراة
            const removeBtn = row.querySelector('.remove-match');
            removeBtn.addEventListener('click', () => {
                const index = Array.from(matchesContainer.children).indexOf(row);
                if (index > -1) {
                    matches.splice(index, 1);
                    renderExistingMatches(); // إعادة ترتيب الأرقام
                }
            });
            
            return row;
        }

        // حفظ المباريات الحالية
        function saveCurrentMatches() {
            matches = [];
            document.querySelectorAll('.match-row').forEach((row, index) => {
                const player1 = row.querySelector('.player1')?.value.trim() || '';
                const player2 = row.querySelector('.player2')?.value.trim() || '';
                const timeInput = row.querySelector('.time-input')?.value || '';
                const amPmBtn = row.querySelector('.am-pm-btn.active');
                const period = amPmBtn ? amPmBtn.getAttribute('data-period') : 'PM';
                const player1Present = row.querySelector('.player1-present')?.checked || false;
                const player2Present = row.querySelector('.player2-present')?.checked || false;
                
                // تحويل الوقت إلى 24 ساعة للحفظ
                const time24h = convertTo24Hour(timeInput, period);
                
                matches.push({ 
                    player1, 
                    player2, 
                    time: time24h,
                    number: index + 1,
                    player1Present,
                    player2Present
                });
            });
        }

        // إضافة مباراة جديدة مع الحفاظ على البيانات الحالية
        function addNewMatch() {
            // حفظ المباريات الحالية أولاً
            saveCurrentMatches();
            
            const newMatch = { 
                player1: "", 
                player2: "", 
                time: "19:00", // وقت افتراضي 7 مساءً
                number: matches.length + 1,
                player1Present: false,
                player2Present: false
            };
            matches.push(newMatch);
            renderExistingMatches(); // إعادة الرسم لتحديث الأرقام
        }

        // عرض المباريات الموجودة مع ترقيم
        function renderExistingMatches() {
            matchesContainer.innerHTML = '';
            matches.forEach((match, index) => {
                const matchNumber = index + 1;
                const row = createMatchRow(match, matchNumber);
                matchesContainer.appendChild(row);
            });
        }

        // الحصول على أحجام الخطوط حسب الاختيار
        function getFontSizes() {
            const sizes = {
                normal: {
                    title: '2.4rem',
                    subtitle: '1.2rem',
                    playerName: '0.95rem',
                    info: '1rem',
                    tablePadding: '12px 8px',
                    extraBottomMargin: '80px',
                    tableHeader: '0.85rem',
                    columnTitle: '1.1rem',
                    tableWidth: '97%',
                    columnGap: '12px'
                },
                medium: {
                    title: '2.6rem',
                    subtitle: '1.3rem',
                    playerName: '1.05rem',
                    info: '1.1rem',
                    tablePadding: '14px 10px',
                    extraBottomMargin: '90px',
                    tableHeader: '0.9rem',
                    columnTitle: '1.15rem',
                    tableWidth: '98%',
                    columnGap: '14px'
                },
                large: {
                    title: '2.8rem',
                    subtitle: '1.4rem',
                    playerName: '1.15rem',
                    info: '1.2rem',
                    tablePadding: '16px 12px',
                    extraBottomMargin: '100px',
                    tableHeader: '0.95rem',
                    columnTitle: '1.2rem',
                    tableWidth: '99%',
                    columnGap: '16px'
                },
                xlarge: {
                    title: '3.0rem',
                    subtitle: '1.5rem',
                    playerName: '1.25rem',
                    info: '1.3rem',
                    tablePadding: '18px 14px',
                    extraBottomMargin: '110px',
                    tableHeader: '1.0rem',
                    columnTitle: '1.25rem',
                    tableWidth: '100%',
                    columnGap: '18px'
                }
            };
            return sizes[selectedFontSize] || sizes.normal;
        }

        // تقسيم المباريات إلى عمودين بالتساوي تقريباً
        function splitMatchesIntoColumns() {
            const middleIndex = Math.ceil(matches.length / 2);
            const firstColumnMatches = matches.slice(0, middleIndex);
            const secondColumnMatches = matches.slice(middleIndex);
            
            return { firstColumnMatches, secondColumnMatches };
        }

        // إنشاء جدول لعمود واحد مع مربعات الاختيار البيضاء (مع إمكانية التحجيم)
        function createTableForColumn(matchesArray, startNumber = 1, columnNumber = 1) {
            const fontSizes = getFontSizes();
            const scale = columnNumber === 1 ? table1Scale : table2Scale;
            
            // حساب أحجام الخطوط بناءً على مستوى التقليص
            const scaledPlayerName = `calc(${fontSizes.playerName} * ${scale})`;
            const scaledTableHeader = `calc(${fontSizes.tableHeader} * ${scale})`;
            const scaledTablePadding = `calc(${fontSizes.tablePadding.split(' ')[0]} * ${scale}) calc(${fontSizes.tablePadding.split(' ')[1]} * ${scale})`;
            
            function formatTimeForDisplay(time24h) {
                if (!time24h) return 'غير محدد';
                
                const [hours, minutes] = time24h.split(':').map(Number);
                let period = 'ص';
                let displayHours = hours;
                
                if (hours >= 12) {
                    period = 'م';
                    if (hours > 12) {
                        displayHours = hours - 12;
                    }
                } else if (hours === 0) {
                    displayHours = 12;
                }
                
                if (minutes === 0) {
                    return `${displayHours} ${period}`;
                }
                
                return `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
            }
            
            if (matchesArray.length === 0) return '';
            
            return `
                <div style="width:100%; max-width:100%; overflow:hidden; border-radius:12px; transform:scale(${scale}); transform-origin:top center;">
                    <table style="width:100%; border-collapse:collapse; background:rgba(0,0,0,0.4); table-layout:fixed;">
                        <thead>
                            <tr>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); width:50px; font-size:${scaledTableHeader}; white-space:nowrap;">رقم</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); width:35px; font-size:${scaledTableHeader};">حضر</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); font-size:${scaledTableHeader}; overflow:hidden; text-overflow:ellipsis;">اللاعب الأول</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); width:60px; font-size:${scaledTableHeader};">VS</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); font-size:${scaledTableHeader}; overflow:hidden; text-overflow:ellipsis;">اللاعب الثاني</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); width:35px; font-size:${scaledTableHeader};">حضر</th>
                                <th style="background:rgba(30,58,138,0.6); padding:${scaledTablePadding}; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); width:90px; font-size:${scaledTableHeader};">الوقت</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${matchesArray.map((m, index) => `
                                <tr>
                                    <td style="padding:calc(10px * ${scale}) calc(6px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName};">
                                        <div style="background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; font-weight:bold; border-radius:50%; width:calc(32px * ${scale}); height:calc(32px * ${scale}); display:flex; align-items:center; justify-content:center; margin:0 auto; font-size:${scaledPlayerName};">
                                            ${startNumber + index}
                                        </div>
                                    </td>
                                    <td style="padding:calc(10px * ${scale}) calc(6px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName};">
                                        <div style="width:calc(20px * ${scale}); height:calc(20px * ${scale}); border:1px solid #cbd5e1; border-radius:3px; margin:0 auto; background:white;"></div>
                                    </td>
                                    <td style="font-weight:700; padding:calc(10px * ${scale}) calc(8px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName}; overflow:hidden; text-overflow:ellipsis; max-width:calc(150px * ${scale});">
                                        ${m.player1 || '—'}
                                    </td>
                                    <td style="padding:calc(10px * ${scale}) calc(6px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName};">
                                        <span style="background:rgba(59,130,246,.3); padding:calc(4px * ${scale}) calc(12px * ${scale}); border-radius:999px; font-weight:bold; display:inline-block; font-size:${scaledPlayerName};">VS</span>
                                    </td>
                                    <td style="font-weight:700; padding:calc(10px * ${scale}) calc(8px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName}; overflow:hidden; text-overflow:ellipsis; max-width:calc(150px * ${scale});">
                                        ${m.player2 || '—'}
                                    </td>
                                    <td style="padding:calc(10px * ${scale}) calc(6px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName};">
                                        <div style="width:calc(20px * ${scale}); height:calc(20px * ${scale}); border:1px solid #cbd5e1; border-radius:3px; margin:0 auto; background:white;"></div>
                                    </td>
                                    <td style="padding:calc(10px * ${scale}) calc(6px * ${scale}); background:rgba(0,0,0,0.35); text-align:center; font-size:${scaledPlayerName};">
                                        <span style="background:rgba(255,255,255,.08); padding:calc(5px * ${scale}) calc(10px * ${scale}); border-radius:6px; display:inline-block; font-size:${scaledPlayerName}; white-space:nowrap;">${formatTimeForDisplay(m.time)}</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // توليد المعاينة مع تقسيم إلى عمودين إذا تجاوزت 13 مباراة
        function generatePreview() {
            saveCurrentMatches();
            const title = document.getElementById('tournament-title').value || "اسم البطولة غير محدد";
            const dateVal = document.getElementById('tournament-date').value ? 
                new Date(document.getElementById('tournament-date').value).toLocaleString('ar-SA', {dateStyle:'full', timeStyle:'short'}) : 
                "التاريخ غير محدد";
            
            const fontSizes = getFontSizes();
            const useTwoColumns = matches.length > 13;
            
            let columnsHtml = '';
            
            if (matches.length > 0) {
                if (useTwoColumns) {
                    const { firstColumnMatches, secondColumnMatches } = splitMatchesIntoColumns();
                    
                    columnsHtml = `
                        <div style="display:flex; gap:${fontSizes.columnGap}; width:${fontSizes.tableWidth}; margin:0 auto; max-width:100%; overflow:hidden;">
                            <div style="flex:1; min-width:0;">
                                <div style="text-align:center; font-size:${fontSizes.columnTitle}; margin-bottom:15px; color:#e2e8f0; padding-bottom:8px; border-bottom:2px solid rgba(59,130,246,.3); white-space:nowrap; transform:scale(${table1Scale}); transform-origin:top center;">
                                    المباريات 1-${firstColumnMatches.length}
                                </div>
                                ${createTableForColumn(firstColumnMatches, 1, 1)}
                            </div>
                            <div style="flex:1; min-width:0;">
                                <div style="text-align:center; font-size:${fontSizes.columnTitle}; margin-bottom:15px; color:#e2e8f0; padding-bottom:8px; border-bottom:2px solid rgba(59,130,246,.3); white-space:nowrap; transform:scale(${table2Scale}); transform-origin:top center;">
                                    المباريات ${firstColumnMatches.length + 1}-${matches.length}
                                </div>
                                ${createTableForColumn(secondColumnMatches, firstColumnMatches.length + 1, 2)}
                            </div>
                        </div>
                    `;
                } else {
                    columnsHtml = `
                        <div style="width:${fontSizes.tableWidth}; margin:0 auto; max-width:100%;">
                            ${createTableForColumn(matches, 1, 1)}
                        </div>
                    `;
                }
            }

            // إضافة مساحة في الأسفل لضمان عدم قص أي شيء
            const bottomSpacing = `
                <div style="height:${fontSizes.extraBottomMargin};"></div>
            `;

            let html = `
                <div style="
                    background: linear-gradient(rgba(10,25,50,0.60), rgba(0,0,0,0.80)), 
                    url('fc26.png') center/cover no-repeat fixed;
                    padding: 25px 15px 15px;
                    border-radius: 16px;
                    color: white;
                    text-shadow: 0 3px 12px rgba(0,0,0,1);
                    min-height: ${matches.length > 20 ? '1200px' : '1000px'};
                    position: relative;
                    width: 100%;
                    max-width: 100%;
                    overflow: hidden;
                ">
                    <h2 style="font-size:${fontSizes.title}; margin-bottom:12px; color:#e0f2fe; text-align:center; font-weight:bold; line-height:1.3; padding:0 10px;">${title}</h2>
                    <p style="font-size:${fontSizes.subtitle}; opacity:1; margin-bottom:25px; text-align:center; padding:0 10px;">${dateVal}</p>

                    ${matches.length > 0 ? `
                        <div style="padding:0 5px;">
                            ${columnsHtml}
                            
                            <div style="margin-top:25px; text-align:center; color:#cbd5e1; font-size:${fontSizes.info}; padding:12px; background:rgba(0,0,0,0.3); border-radius:8px; width:80%; margin-left:auto; margin-right:auto; max-width:600px;">
                                <i class="fas fa-info-circle"></i> إجمالي عدد المباريات: <strong>${matches.length}</strong> مباراة
                            </div>
                        </div>
                    ` : `
                        <div class="empty-message">
                            <i class="fas fa-futbol"></i>
                            <h3>لا توجد مباريات مضافة بعد</h3>
                        </div>
                    `}
                    
                    ${bottomSpacing}
                </div>
            `;

            previewContainer.innerHTML = html;
            updateScaleDisplay(); // تحديث عرض مستويات التقليص
        }

        // تحميل PDF
        async function downloadPDF() {
            saveCurrentMatches();
            if (matches.length === 0) {
                alert("أضف مباراة واحدة على الأقل قبل التحميل");
                return;
            }
            
            generatePreview();
            await new Promise(r => setTimeout(r, 1500)); // زيادة الوقت للتأكد من تحميل الصورة
            
            const el = previewContainer.firstElementChild;
            
            // زيادة حجم الصورة التي سيتم تحويلها لضمان جودة عالية
            const scaleFactor = matches.length > 20 ? 2.8 : 2.5;
            
            html2canvas(el, {
                scale: scaleFactor,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null,
                logging: false,
                width: el.offsetWidth,
                height: el.offsetHeight,
                onclone: function(clonedDoc) {
                    // التأكد من أن الخلفية محملة في المستنسخ
                    const clonedEl = clonedDoc.querySelector('#preview-container > div');
                    if (clonedEl) {
                        clonedEl.style.backgroundImage = `linear-gradient(rgba(10,25,50,0.60), rgba(0,0,0,0.80)), url('fc26.png')`;
                        clonedEl.style.width = '100%';
                        clonedEl.style.maxWidth = '100%';
                    }
                }
            }).then(canvas => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // حساب الأبعاد مع الحفاظ على التناسب
                const pdfWidth = 210; // عرض A4 بالمليمتر
                const pdfHeight = 297; // ارتفاع A4 بالمليمتر
                
                const imgWidth = pdfWidth;
                const imgHeight = (canvas.height * pdfWidth) / canvas.width;
                
                // إضافة الصورة
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save(`جدول-FCC26-EAFC26-${Date.now()}.pdf`);
            }).catch(err => {
                console.error(err);
                alert("خطأ في التقاط الصورة: " + err.message);
            });
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', () => {
            // ربط أحداث اختيار حجم الخط
            document.querySelectorAll('.font-size-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.font-size-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedFontSize = this.getAttribute('data-size');
                    generatePreview();
                });
            });
            
            // ربط الأحداث الرئيسية
            addMatchBtn.addEventListener('click', addNewMatch);
            previewBtn.addEventListener('click', generatePreview);
            downloadBtn.addEventListener('click', downloadPDF);
            
            // ربط أحداث التحكم في الجداول
            document.getElementById('shrink-table1-btn').addEventListener('click', () => {
                if (table1Scale > minScale) {
                    table1Scale -= table1ScaleStep;
                    generatePreview();
                }
            });
            
            document.getElementById('expand-table1-btn').addEventListener('click', () => {
                if (table1Scale < maxScale) {
                    table1Scale += table1ScaleStep;
                    generatePreview();
                }
            });
            
            document.getElementById('shrink-table2-btn').addEventListener('click', () => {
                if (table2Scale > minScale) {
                    table2Scale -= table2ScaleStep;
                    generatePreview();
                }
            });
            
            document.getElementById('expand-table2-btn').addEventListener('click', () => {
                if (table2Scale < maxScale) {
                    table2Scale += table2ScaleStep;
                    generatePreview();
                }
            });
            
            document.getElementById('reset-tables-btn').addEventListener('click', () => {
                table1Scale = 1.0;
                table2Scale = 1.0;
                generatePreview();
            });
            
            // عرض المباريات الابتدائية
            renderExistingMatches();
            
            // توليد معاينة أولية
            generatePreview();
            
            // تعيين التاريخ الحالي كقيمة افتراضية
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('tournament-date').value = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            // إضافة حدث لحفظ البيانات عند التعديل
            matchesContainer.addEventListener('input', () => {
                saveCurrentMatches();
            });
            
            // إضافة حدث لحفظ حالة checkboxes
            matchesContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('attendance-checkbox-input')) {
                    saveCurrentMatches();
                }
            });
        });
    </script>
</body>
</html>