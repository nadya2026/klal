<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCC 26 - نظام إدارة جداول المباريات EA FC 26</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI','Noto Sans Arabic',Tahoma,sans-serif; }
        body { background:#0f172a; color:#e2e8f0; line-height:1.6; min-height:100vh; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        .header { background:linear-gradient(135deg,rgba(10,25,50,.9),rgba(0,0,0,.95)); color:white; padding:25px 40px; border-radius:15px; margin-bottom:30px; box-shadow:0 4px 20px rgba(0,0,0,.6); border:1px solid rgba(59,130,246,.3); }
        .header-content { display:flex; justify-content:space-between; align-items:center; }
        .logo-section { display:flex; align-items:center; gap:20px; }
        .logo { width:70px; height:70px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); border-radius:12px; display:flex; align-items:center; justify-content:center; color:white; font-size:28px; font-weight:bold; box-shadow:0 4px 15px rgba(59,130,246,.4); }
        .title-section h1 { font-size:28px; font-weight:700; margin-bottom:5px; }
        .title-section p { color:#94a3b8; font-size:16px; }
        .badge { background:rgba(59,130,246,.2); padding:8px 20px; border-radius:20px; font-size:14px; font-weight:600; border:1px solid rgba(59,130,246,.4); }
        .main-grid { display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:40px; }
        @media (max-width:1024px) { .main-grid { grid-template-columns:1fr; } }
        .card { background:rgba(15,23,42,.7); border-radius:15px; padding:30px; box-shadow:0 4px 20px rgba(0,0,0,.5); border:1px solid rgba(59,130,246,.2); backdrop-filter:blur(8px); }
        .card-title { font-size:20px; color:#e2e8f0; margin-bottom:25px; padding-bottom:15px; border-bottom:2px solid rgba(59,130,246,.3); font-weight:600; }
        .card-title i { color:#3b82f6; margin-left:10px; }
        .form-group { margin-bottom:25px; }
        .form-label { display:block; margin-bottom:8px; color:#cbd5e1; font-weight:600; font-size:15px; }
        .form-control { width:100%; padding:14px 18px; border:2px solid rgba(59,130,246,.3); border-radius:10px; font-size:15px; background:rgba(30,41,59,.6); color:white; transition:all .3s; }
        .form-control:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.3); }
        .match-row { background:rgba(30,41,59,.5); border-radius:12px; padding:25px; margin-bottom:15px; border:1px solid rgba(59,130,246,.2); position:relative; }
        .match-number { position:absolute; top:20px; right:20px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:bold; box-shadow:0 4px 15px rgba(59,130,246,.4); }
        .player-input { text-align:center; padding:15px; background:rgba(15,23,42,.8); border:2px solid rgba(59,130,246,.3); border-radius:8px; color:white; font-size:16px; font-weight:500; width:100%; }
        .vs-circle { width:60px; height:60px; background:linear-gradient(135deg,#3b82f6,#1d4ed8); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px; box-shadow:0 4px 15px rgba(59,130,246,.5); }
        .time-input-container { display:flex; align-items:center; justify-content:center; gap:10px; margin-top:15px; }
        .time-input { padding:10px 20px; border:2px solid rgba(59,130,246,.3); border-radius:8px; background:rgba(15,23,42,.8); color:white; font-size:15px; width:120px; text-align:center; }
        .am-pm-btn { padding:10px 15px; border:2px solid rgba(59,130,246,.3); border-radius:8px; background:rgba(15,23,42,.8); color:white; cursor:pointer; min-width:60px; }
        .am-pm-btn.active { background:#3b82f6; border-color:#3b82f6; }
        .remove-match { position:absolute; top:15px; left:15px; width:36px; height:36px; border-radius:8px; background:rgba(239,68,68,.2); border:none; color:#ef4444; cursor:pointer; }
        .add-match-btn { width:100%; padding:16px; background:#3b82f6; color:white; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; }
        .add-match-btn:hover { background:#2563eb; }
        .control-buttons { display:flex; gap:15px; margin-top:30px; }
        .btn { flex:1; padding:16px; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; }
        .btn-preview { background:#10b981; color:white; }
        .btn-download { background:#f59e0b; color:white; }
        .preview-section { background:rgba(15,23,42,.7); border-radius:15px; padding:30px; box-shadow:0 4px 20px rgba(0,0,0,.5); border:1px solid rgba(59,130,246,.2); min-height:700px; }
        .preview-table { width:100%; border-collapse:collapse; margin-top:30px; color:white; }
        .preview-table th { background:rgba(30,58,138,.6); padding:18px; text-align:center; border-bottom:2px solid rgba(59,130,246,.4); }
        .preview-table td { padding:20px; text-align:center; border-bottom:1px solid rgba(59,130,246,.2); }
        .match-number-cell { background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; font-weight:bold; font-size:20px; border-radius:50%; width:50px; height:50px; display:flex; align-items:center; justify-content:center; margin:0 auto; }
        .vs-cell { background:rgba(59,130,246,.3); padding:8px 24px; border-radius:999px; font-weight:bold; }
        .time-cell { background:rgba(255,255,255,.08); padding:10px 20px; border-radius:8px; }
        .empty-message { text-align:center; padding:100px 20px; color:#94a3b8; }
        .empty-message i { font-size:5rem; opacity:.4; }
        .footer { text-align:center; margin-top:50px; padding-top:30px; border-top:1px solid rgba(59,130,246,.2); color:#94a3b8; font-size:14px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">FCC</div>
                    <div class="title-section">
                        <h1>بطولة FCC 26 - EA FC 26</h1>
                        <p>جدول المباريات - النسخة الاحترافية</p>
                    </div>
                </div>
                <div class="badge">EA SPORTS FC™ 26</div>
            </div>
        </header>

        <div class="main-grid">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-cog"></i> إعدادات البطولة</h2>
                <div class="form-group">
                    <label class="form-label">اسم البطولة</label>
                    <input type="text" id="tournament-title" class="form-control" value="دوري الصيفي المعسكر EA SPORTS FC™ 26">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ ووقت البطولة</label>
                    <input type="datetime-local" id="tournament-date" class="form-control">
                </div>

                <h2 class="card-title" style="margin-top:40px;"><i class="fas fa-futbol"></i> إدارة المباريات</h2>
                <div id="matches-container"></div>
                <button id="add-match-btn" class="add-match-btn">
                    <i class="fas fa-plus"></i> إضافة مباراة جديدة
                </button>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-eye"></i> معاينة وتحميل</h2>
                <p style="color:#94a3b8; margin-bottom:20px;">خلفية محلية (fc26.png)</p>
                <div class="control-buttons">
                    <button id="preview-btn" class="btn btn-preview">
                        <i class="fas fa-eye"></i> معاينة الجدول
                    </button>
                    <button id="download-btn" class="btn btn-download">
                        <i class="fas fa-download"></i> تحميل PDF
                    </button>
                </div>
            </div>
        </div>

        <div class="preview-section">
            <div id="preview-container">
                <div class="empty-message">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>اضغط "معاينة الجدول" بعد إضافة المباريات</h3>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>© 2026 نظام جداول FCC 26 - مستوحى من EA SPORTS FC™ 26</p>
        </footer>
    </div>

    <script>
        let matches = [];
        const matchesContainer = document.getElementById('matches-container');
        const addMatchBtn = document.getElementById('add-match-btn');
        const previewBtn = document.getElementById('preview-btn');
        const downloadBtn = document.getElementById('download-btn');
        const previewContainer = document.getElementById('preview-container');

        // دالة لتحويل الوقت من 12 ساعة إلى 24 ساعة
        function convertTo24Hour(time12h, period) {
            if (!time12h) return '';
            
            const [hours, minutes] = time12h.split(':').map(Number);
            let hours24 = hours;
            
            if (period === 'PM' && hours < 12) {
                hours24 = hours + 12;
            } else if (period === 'AM' && hours === 12) {
                hours24 = 0;
            }
            
            return `${hours24.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // دالة لتحويل الوقت من 24 ساعة إلى 12 ساعة
        function convertTo12Hour(time24h) {
            if (!time24h) return { time: '', period: 'PM' };
            
            const [hours, minutes] = time24h.split(':').map(Number);
            let period = 'AM';
            let hours12 = hours;
            
            if (hours >= 12) {
                period = 'PM';
                if (hours > 12) {
                    hours12 = hours - 12;
                }
            } else if (hours === 0) {
                hours12 = 12;
            }
            
            return {
                time: `${hours12.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`,
                period: period
            };
        }

        // دالة لإنشاء صف مباراة جديد
        function createMatchRow(matchData = { player1: "", player2: "", time: "" }, matchNumber) {
            const row = document.createElement('div');
            row.className = 'match-row';
            
            // تحويل الوقت إلى تنسيق 12 ساعة للعرض
            const time12h = convertTo12Hour(matchData.time || '19:00');
            
            row.innerHTML = `
                <div class="match-number">${matchNumber}</div>
                <button class="remove-match"><i class="fas fa-trash"></i></button>
                <div style="display:flex; align-items:center; justify-content:center; gap:20px; margin:20px 0;">
                    <input type="text" class="player-input player1" placeholder="اسم اللاعب الأول" value="${matchData.player1 || ''}">
                    <div class="vs-circle">VS</div>
                    <input type="text" class="player-input player2" placeholder="اسم اللاعب الثاني" value="${matchData.player2 || ''}">
                </div>
                <div class="time-input-container">
                    <span style="color:#94a3b8;">الوقت:</span>
                    <input type="time" class="time-input" value="${time12h.time}" step="300">
                    <button type="button" class="am-pm-btn ${time12h.period === 'PM' ? 'active' : ''}" data-period="PM">م</button>
                    <button type="button" class="am-pm-btn ${time12h.period === 'AM' ? 'active' : ''}" data-period="AM">ص</button>
                </div>
            `;
            
            // إضافة أحداث لأزرار AM/PM
            const amBtn = row.querySelector('[data-period="AM"]');
            const pmBtn = row.querySelector('[data-period="PM"]');
            const timeInput = row.querySelector('.time-input');
            
            function updatePeriodButtons(activePeriod) {
                amBtn.classList.toggle('active', activePeriod === 'AM');
                pmBtn.classList.toggle('active', activePeriod === 'PM');
            }
            
            amBtn.addEventListener('click', () => {
                updatePeriodButtons('AM');
            });
            
            pmBtn.addEventListener('click', () => {
                updatePeriodButtons('PM');
            });
            
            // إضافة حدث لحذف المباراة
            const removeBtn = row.querySelector('.remove-match');
            removeBtn.addEventListener('click', () => {
                const index = Array.from(matchesContainer.children).indexOf(row);
                if (index > -1) {
                    matches.splice(index, 1);
                    renderExistingMatches(); // إعادة ترتيب الأرقام
                }
            });
            
            return row;
        }

        // حفظ المباريات الحالية
        function saveCurrentMatches() {
            matches = [];
            document.querySelectorAll('.match-row').forEach((row, index) => {
                const player1 = row.querySelector('.player1')?.value.trim() || '';
                const player2 = row.querySelector('.player2')?.value.trim() || '';
                const timeInput = row.querySelector('.time-input')?.value || '';
                const amPmBtn = row.querySelector('.am-pm-btn.active');
                const period = amPmBtn ? amPmBtn.getAttribute('data-period') : 'PM';
                
                // تحويل الوقت إلى 24 ساعة للحفظ
                const time24h = convertTo24Hour(timeInput, period);
                
                matches.push({ 
                    player1, 
                    player2, 
                    time: time24h,
                    number: index + 1
                });
            });
        }

        // إضافة مباراة جديدة
        function addNewMatch() {
            const newMatch = { 
                player1: "", 
                player2: "", 
                time: "19:00", // وقت افتراضي 7 مساءً
                number: matches.length + 1
            };
            matches.push(newMatch);
            renderExistingMatches(); // إعادة الرسم لتحديث الأرقام
        }

        // عرض المباريات الموجودة مع ترقيم
        function renderExistingMatches() {
            matchesContainer.innerHTML = '';
            matches.forEach((match, index) => {
                const matchNumber = index + 1;
                const row = createMatchRow(match, matchNumber);
                matchesContainer.appendChild(row);
            });
        }

        // توليد المعاينة مع عرض الوقت بصيغة واضحة
        function generatePreview() {
            saveCurrentMatches();
            const title = document.getElementById('tournament-title').value || "دوري الصيفي المعسكر EA SPORTS FC™ 26";
            const dateVal = document.getElementById('tournament-date').value ? 
                new Date(document.getElementById('tournament-date').value).toLocaleString('ar-SA', {dateStyle:'full', timeStyle:'short'}) : 
                "التاريخ غير محدد";

            // دالة لعرض الوقت بصيغة واضحة
            function formatTimeForDisplay(time24h) {
                if (!time24h) return 'غير محدد';
                
                const [hours, minutes] = time24h.split(':').map(Number);
                let period = 'ص';
                let displayHours = hours;
                
                if (hours >= 12) {
                    period = 'م';
                    if (hours > 12) {
                        displayHours = hours - 12;
                    }
                } else if (hours === 0) {
                    displayHours = 12;
                }
                
                // إذا كانت الدقائق تساوي 0، لا نعرضها
                if (minutes === 0) {
                    return `${displayHours} ${period}`;
                }
                
                return `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
            }

            let html = `
                <div style="
                    background: linear-gradient(rgba(10,25,50,0.60), rgba(0,0,0,0.80)), 
                    url('fc26.png') center/cover no-repeat fixed;
                    padding: 50px 30px;
                    border-radius: 16px;
                    color: white;
                    text-shadow: 0 3px 12px rgba(0,0,0,1);
                    min-height: 800px;
                ">
                    <h2 style="font-size:2.8rem; margin-bottom:15px; color:#e0f2fe; text-align:center; font-weight:bold;">${title}</h2>
                    <p style="font-size:1.4rem; opacity:1; margin-bottom:50px; text-align:center;">${dateVal}</p>

                    ${matches.length > 0 ? `
                        <table class="preview-table" style="max-width:98%; margin:0 auto; background:rgba(0,0,0,0.4); border-radius:12px; overflow:hidden;">
                            <thead>
                                <tr>
                                    <th style="background:rgba(30,58,138,0.6); width:80px;">رقم المباراة</th>
                                    <th style="background:rgba(30,58,138,0.6);">اللاعب الأول</th>
                                    <th style="background:rgba(30,58,138,0.6); width:100px;">المواجهة</th>
                                    <th style="background:rgba(30,58,138,0.6);">اللاعب الثاني</th>
                                    <th style="background:rgba(30,58,138,0.6); width:150px;">الوقت</th>
                                </tr>
                            </thead>
                            <tbody>
                    ` : ''}

                    ${matches.map((m, index) => `
                        <tr>
                            <td style="padding:25px 10px; background:rgba(0,0,0,0.35);">
                                <div class="match-number-cell">${index + 1}</div>
                            </td>
                            <td style="font-weight:700; font-size:1.3rem; padding:25px 20px; background:rgba(0,0,0,0.35);">${m.player1 || '—'}</td>
                            <td style="padding:25px 10px; background:rgba(0,0,0,0.35);">
                                <span class="vs-cell">VS</span>
                            </td>
                            <td style="font-weight:700; font-size:1.3rem; padding:25px 20px; background:rgba(0,0,0,0.35);">${m.player2 || '—'}</td>
                            <td style="padding:25px 10px; background:rgba(0,0,0,0.35);">
                                <span class="time-cell">${formatTimeForDisplay(m.time)}</span>
                            </td>
                        </tr>
                    `).join('')}

                    ${matches.length > 0 ? `</tbody></table>` : `
                        <div class="empty-message">
                            <i class="fas fa-futbol"></i>
                            <h3>لا توجد مباريات مضافة بعد</h3>
                        </div>
                    `}
                    
                    ${matches.length > 0 ? `
                        <div style="margin-top:40px; text-align:center; color:#cbd5e1; font-size:1.2rem;">
                            <i class="fas fa-info-circle"></i> إجمالي عدد المباريات: <strong>${matches.length}</strong> مباراة
                        </div>
                    ` : ''}
                </div>
            `;

            previewContainer.innerHTML = html;
        }

        // تحميل PDF
        async function downloadPDF() {
            saveCurrentMatches();
            if (matches.length === 0) {
                alert("أضف مباراة واحدة على الأقل قبل التحميل");
                return;
            }
            
            generatePreview();
            await new Promise(r => setTimeout(r, 500));
            
            const el = previewContainer.firstElementChild;
            html2canvas(el, {
                scale: 3,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null
            }).then(canvas => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const w = 210;
                const h = (canvas.height * w) / canvas.width;
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, w, h);
                pdf.save(`جدول-FCC26-EAFC26-${Date.now()}.pdf`);
            }).catch(err => {
                console.error(err);
                alert("خطأ في التقاط الصورة: " + err.message);
            });
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', () => {
            // ربط الأحداث
            addMatchBtn.addEventListener('click', addNewMatch);
            previewBtn.addEventListener('click', generatePreview);
            downloadBtn.addEventListener('click', downloadPDF);
            
            // تهيئة مباريات ابتدائية
            matches = [
                { player1: "الفريق أ", player2: "الفريق ب", time: "19:00" },
                { player1: "الفريق ج", player2: "الفريق د", time: "20:30" },
                { player1: "الفريق هـ", player2: "الفريق و", time: "22:00" }
            ];
            
            // عرض المباريات الابتدائية
            renderExistingMatches();
            
            // توليد معاينة أولية
            generatePreview();
            
            // تعيين التاريخ الحالي كقيمة افتراضية
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('tournament-date').value = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            // إضافة حدث لإعادة الترقيم عند التعديل
            matchesContainer.addEventListener('input', () => {
                saveCurrentMatches();
            });
        });
    </script>
</body>
</html>